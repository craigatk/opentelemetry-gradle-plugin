buildscript {
    repositories {
        gradlePluginPortal()
        mavenCentral()
    }
}

plugins {
    id 'java-gradle-plugin'
    id 'maven-publish'
    id "org.jetbrains.kotlin.jvm" version "1.7.10"
    id "org.jlleitschuh.gradle.ktlint" version "10.3.0"
    id "dev.projektor.publish" version "7.7.0"
    id 'com.gradle.plugin-publish' version "0.21.0"
}

group = "com.atkinsondev"
version = "0.0.10"

gradlePlugin {
    plugins {
        opentelemetryPlugin {
            id = 'com.atkinsondev.opentelemetry-build'
            implementationClass = 'com.atkinsondev.opentelemetry.build.OpenTelemetryBuildPlugin'
        }
    }
}

repositories {
    mavenCentral()
}

dependencies {
    implementation("io.opentelemetry:opentelemetry-api:$otelVersion")
    implementation("io.opentelemetry:opentelemetry-sdk:$otelVersion")
    implementation("io.opentelemetry:opentelemetry-exporter-otlp:$otelVersion")
    implementation("io.opentelemetry:opentelemetry-semconv:$otelVersion-alpha")

    testImplementation gradleTestKit()

    testImplementation(platform("org.junit:junit-bom:5.9.0"))
    testImplementation("org.junit.jupiter:junit-jupiter")

    testImplementation "com.github.tomakehurst:wiremock-jre8:2.33.2"

    testImplementation("io.strikt:strikt-core:0.34.1")

    testImplementation 'org.awaitility:awaitility-kotlin:4.2.0'
}

test {
    useJUnitPlatform()
}

ktlint {
    disabledRules = ["no-wildcard-imports"]
}

projektor {
    serverUrl = "https://projektorlive.herokuapp.com"
    publishToken = System.getenv("PROJEKTOR_TOKEN") ?: project.findProperty('projektor_publish_token') ?: null
}

/*
openTelemetryBuild {
    endpoint = "https://api.honeycomb.io"
    headers = ["x-honeycomb-team": "<team>", "x-honeycomb-dataset": "otel-gradle"]
}
 */
